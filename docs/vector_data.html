<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Import Vector Data | Black Hills Experimental Forest Prescribed Fire Planning</title>
  <meta name="description" content="Using the bookdown package to write a book for BHEF Rx fire planning. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Import Vector Data | Black Hills Experimental Forest Prescribed Fire Planning" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book for BHEF Rx fire planning. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Import Vector Data | Black Hills Experimental Forest Prescribed Fire Planning" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book for BHEF Rx fire planning. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />


<meta name="date" content="2022-08-08" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="objective.html"/>
<link rel="next" href="stem_map.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="index.html#introduction" id="toc-introduction"><span class="toc-section-number">1</span> Introduction<span></span></a></li>
<li><a href="objective.html#objective" id="toc-objective"><span class="toc-section-number">2</span> Objective<span></span></a></li>
<li><a href="vector_data.html#vector_data" id="toc-vector_data"><span class="toc-section-number">3</span> Import Vector Data<span></span></a>
<ul>
<li><a href="vector_data.html#national-forest-management-data-download" id="toc-national-forest-management-data-download"><span class="toc-section-number">3.1</span> National Forest Management data download<span></span></a></li>
<li><a href="vector_data.html#load-research-plot-data" id="toc-load-research-plot-data"><span class="toc-section-number">3.2</span> Load Research Plot data<span></span></a></li>
<li><a href="vector_data.html#load-stem-map-data" id="toc-load-stem-map-data"><span class="toc-section-number">3.3</span> Load Stem Map data<span></span></a></li>
<li><a href="vector_data.html#load-national-forests-shapefile" id="toc-load-national-forests-shapefile"><span class="toc-section-number">3.4</span> Load National Forests shapefile<span></span></a></li>
<li><a href="vector_data.html#load-experimental-forests-shapefile" id="toc-load-experimental-forests-shapefile"><span class="toc-section-number">3.5</span> Load Experimental Forests shapefile<span></span></a></li>
<li><a href="vector_data.html#harvests" id="toc-harvests"><span class="toc-section-number">3.6</span> Load FACTS Timber Harvests<span></span></a>
<ul>
<li><a href="vector_data.html#harvests-by-treatment-type" id="toc-harvests-by-treatment-type"><span class="toc-section-number">3.6.1</span> Harvests by treatment type<span></span></a></li>
</ul></li>
<li><a href="vector_data.html#join-research-plot-to-harvest" id="toc-join-research-plot-to-harvest"><span class="toc-section-number">3.7</span> Join Research Plot to Harvest<span></span></a></li>
<li><a href="vector_data.html#join-stem-map-to-research-plot-harvest" id="toc-join-stem-map-to-research-plot-harvest"><span class="toc-section-number">3.8</span> Join Stem Map to Research Plot &amp; Harvest<span></span></a>
<ul>
<li><a href="vector_data.html#stem-map-descriptive-statistics." id="toc-stem-map-descriptive-statistics."><span class="toc-section-number">3.8.1</span> Stem Map Descriptive statistics.<span></span></a></li>
</ul></li>
<li><a href="vector_data.html#map-harvests-research-plots-stem-map" id="toc-map-harvests-research-plots-stem-map"><span class="toc-section-number">3.9</span> Map Harvests, Research Plots, Stem Map<span></span></a></li>
<li><a href="vector_data.html#write-out-data" id="toc-write-out-data"><span class="toc-section-number">3.10</span> Write Out Data<span></span></a></li>
</ul></li>
<li><a href="stem_map.html#stem_map" id="toc-stem_map"><span class="toc-section-number">4</span> Analyze Lidar Data<span></span></a>
<ul>
<li><a href="stem_map.html#download-data-from-natl-map" id="toc-download-data-from-natl-map"><span class="toc-section-number">4.1</span> Download Data From Nat’l Map<span></span></a></li>
<li><a href="stem_map.html#load-vector-data" id="toc-load-vector-data"><span class="toc-section-number">4.2</span> Load Vector Data<span></span></a></li>
<li><a href="stem_map.html#load-elevation-data" id="toc-load-elevation-data"><span class="toc-section-number">4.3</span> Load Elevation Data<span></span></a></li>
<li><a href="stem_map.html#load-lidar-data" id="toc-load-lidar-data"><span class="toc-section-number">4.4</span> Load Lidar Data<span></span></a>
<ul>
<li><a href="stem_map.html#height-normalization-using-dem" id="toc-height-normalization-using-dem"><span class="toc-section-number">4.4.1</span> Height normalization using DEM<span></span></a></li>
<li><a href="stem_map.html#canopy-height-model" id="toc-canopy-height-model"><span class="toc-section-number">4.4.2</span> Canopy Height model<span></span></a></li>
<li><a href="stem_map.html#individual-tree-detection-itd" id="toc-individual-tree-detection-itd"><span class="toc-section-number">4.4.3</span> Individual Tree Detection (ITD)<span></span></a></li>
<li><a href="stem_map.html#individual-tree-segmentation-its" id="toc-individual-tree-segmentation-its"><span class="toc-section-number">4.4.4</span> Individual Tree Segmentation (ITS)<span></span></a></li>
<li><a href="stem_map.html#plot-crown-groups" id="toc-plot-crown-groups"><span class="toc-section-number">4.4.5</span> Plot Crown Groups<span></span></a></li>
</ul></li>
<li><a href="stem_map.html#map-harvests-research-plots-stem-map-1" id="toc-map-harvests-research-plots-stem-map-1"><span class="toc-section-number">4.5</span> Map Harvests, Research Plots, Stem Map<span></span></a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Black Hills Experimental Forest Prescribed Fire Planning</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="vector_data" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Import Vector Data<a href="vector_data.html#vector_data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="vector_data.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># turn off the s2 processing </span></span>
<span id="cb1-2"><a href="vector_data.html#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="do">## https://stackoverflow.com/questions/68478179/how-to-resolve-spherical-geometry-failures-when-joining-spatial-data</span></span>
<span id="cb1-3"><a href="vector_data.html#cb1-3" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">sf_use_s2</span>(<span class="cn">FALSE</span>)</span></code></pre></div>
<div id="national-forest-management-data-download" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> National Forest Management data download<a href="vector_data.html#national-forest-management-data-download" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The Forest Activity Tracking System (FACTS) <a href="https://data.fs.usda.gov/geodata/edw/datasets.php?xmlKeyword">database</a> maintained by the U.S. Department of Agriculture, Forest Service (USFS) used to delineate georeferenced boundaries of forest harvest activities.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="vector_data.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># check for data and download</span></span>
<span id="cb2-2"><a href="vector_data.html#cb2-2" aria-hidden="true" tabindex="-1"></a>zip_path <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb2-3"><a href="vector_data.html#cb2-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;https://data.fs.usda.gov/geodata/edw/edw_resources/fc/S_USA.NFSLandUnit.gdb.zip&quot;</span>  <span class="co"># forests boundaries</span></span>
<span id="cb2-4"><a href="vector_data.html#cb2-4" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;https://data.fs.usda.gov/geodata/edw/edw_resources/fc/S_USA.Experimental_Area_Boundaries.gdb.zip&quot;</span> <span class="co"># exp forest boundaries</span></span>
<span id="cb2-5"><a href="vector_data.html#cb2-5" aria-hidden="true" tabindex="-1"></a>    <span class="co"># , &quot;https://data.fs.usda.gov/geodata/edw/edw_resources/fc/S_USA.Activity_TimberHarvest.gdb.zip&quot; # Timber Harvests</span></span>
<span id="cb2-6"><a href="vector_data.html#cb2-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># , &quot;https://data.fs.usda.gov/geodata/edw/edw_resources/shp/S_USA.Activity_HazFuelTrt_PL.zip&quot; # Hazardous Fuel Treatment Reduction</span></span>
<span id="cb2-7"><a href="vector_data.html#cb2-7" aria-hidden="true" tabindex="-1"></a>    <span class="co"># , &quot;https://data.fs.usda.gov/geodata/edw/edw_resources/shp/S_USA.Activity_SilvTSI.zip&quot; # SilvTSI (Silviculture Timber Stand Improvement)</span></span>
<span id="cb2-8"><a href="vector_data.html#cb2-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># , &quot;https://data.fs.usda.gov/geodata/edw/edw_resources/shp/S_USA.Activity_SilvReforestation.zip&quot; # SilvReforestation</span></span>
<span id="cb2-9"><a href="vector_data.html#cb2-9" aria-hidden="true" tabindex="-1"></a>    <span class="co"># , &quot;https://edcintl.cr.usgs.gov/downloads/sciweb1/shared/MTBS_Fire/data/composite_data/burned_area_extent_shapefile/mtbs_perimeter_data.zip&quot;</span></span>
<span id="cb2-10"><a href="vector_data.html#cb2-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb2-11"><a href="vector_data.html#cb2-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-12"><a href="vector_data.html#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(zip_path)) {</span>
<span id="cb2-13"><a href="vector_data.html#cb2-13" aria-hidden="true" tabindex="-1"></a>  f_nm <span class="ot">&lt;-</span> <span class="fu">paste0</span>( <span class="st">&quot;../data/&quot;</span></span>
<span id="cb2-14"><a href="vector_data.html#cb2-14" aria-hidden="true" tabindex="-1"></a>    , <span class="fu">str_split</span>(zip_path[i], <span class="st">&quot;/&quot;</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>)[<span class="fu">length</span>(<span class="fu">str_split</span>(zip_path[i], <span class="st">&quot;/&quot;</span>, <span class="at">simplify =</span> <span class="cn">TRUE</span>))]</span>
<span id="cb2-15"><a href="vector_data.html#cb2-15" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb2-16"><a href="vector_data.html#cb2-16" aria-hidden="true" tabindex="-1"></a>  fldr <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="fu">gsub</span>(<span class="st">&quot;.zip&quot;</span>, <span class="st">&quot;&quot;</span>, f_nm))</span>
<span id="cb2-17"><a href="vector_data.html#cb2-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">timeout =</span> <span class="dv">60</span> <span class="sc">*</span> <span class="dv">15</span>)</span>
<span id="cb2-18"><a href="vector_data.html#cb2-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">file.exists</span>(fldr) <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb2-19"><a href="vector_data.html#cb2-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># download data</span></span>
<span id="cb2-20"><a href="vector_data.html#cb2-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">file.exists</span>(f_nm) <span class="sc">==</span> <span class="cn">FALSE</span>){</span>
<span id="cb2-21"><a href="vector_data.html#cb2-21" aria-hidden="true" tabindex="-1"></a>      <span class="fu">download.file</span>(zip_path[i], <span class="at">destfile =</span> f_nm)</span>
<span id="cb2-22"><a href="vector_data.html#cb2-22" aria-hidden="true" tabindex="-1"></a>    }<span class="cf">else</span>{<span class="fu">print</span>(<span class="st">&quot;file already exists&quot;</span>)}</span>
<span id="cb2-23"><a href="vector_data.html#cb2-23" aria-hidden="true" tabindex="-1"></a>    <span class="co"># unzip</span></span>
<span id="cb2-24"><a href="vector_data.html#cb2-24" aria-hidden="true" tabindex="-1"></a>    <span class="fu">unzip</span>(f_nm, <span class="at">overwrite=</span><span class="cn">TRUE</span>, <span class="at">exdir =</span> fldr)</span>
<span id="cb2-25"><a href="vector_data.html#cb2-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">file.remove</span>(f_nm)</span>
<span id="cb2-26"><a href="vector_data.html#cb2-26" aria-hidden="true" tabindex="-1"></a>  }<span class="cf">else</span>{<span class="fu">print</span>(<span class="st">&quot;unzip already exists&quot;</span>)}</span>
<span id="cb2-27"><a href="vector_data.html#cb2-27" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="load-research-plot-data" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Load Research Plot data<a href="vector_data.html#load-research-plot-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://esajournals.onlinelibrary.wiley.com/doi/pdfdirect/10.1002/eap.2682">Ritter et al. 2022</a> established eleven, 100x100 m (1-ha), plots within mechanical treatment units. Measurements occurred during the summer of 2017, which represented 3 years post-treatment for small group retention treatment and 4 years post-treatment for free selection-off, free selection-On, and commercial thinning treatments. In the free selection-off treatments, overstory trees were included in the spacing guidelines for precommercial thinning treatment. In the free selection-on treatments, overstory trees were not included in the spacing guidelines for precommercial thinning treatments resulting in residual precommercial trees potentially growing under the crown of an overstory tree.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="vector_data.html#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load shapefile</span></span>
<span id="cb3-2"><a href="vector_data.html#cb3-2" aria-hidden="true" tabindex="-1"></a>research_plots <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;../data/Black_Hills_StemMaps.shp&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-3"><a href="vector_data.html#cb3-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(sf<span class="sc">::</span><span class="fu">st_is_valid</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb3-4"><a href="vector_data.html#cb3-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">tolower</span>(</span>
<span id="cb3-5"><a href="vector_data.html#cb3-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>, </span>
<span id="cb3-6"><a href="vector_data.html#cb3-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">str_trim</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s+&quot;</span>, <span class="st">&quot; &quot;</span>, .x))</span>
<span id="cb3-7"><a href="vector_data.html#cb3-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb3-8"><a href="vector_data.html#cb3-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb3-9"><a href="vector_data.html#cb3-9" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_buffer</span>(<span class="at">dist =</span> <span class="dv">50</span>, <span class="at">endCapStyle =</span> <span class="st">&quot;SQUARE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb3-10"><a href="vector_data.html#cb3-10" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">area =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.))</span>
<span id="cb3-11"><a href="vector_data.html#cb3-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-12"><a href="vector_data.html#cb3-12" aria-hidden="true" tabindex="-1"></a><span class="co">#rename sf geom column</span></span>
<span id="cb3-13"><a href="vector_data.html#cb3-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(research_plots)[<span class="fu">names</span>(research_plots)<span class="sc">==</span><span class="fu">tolower</span>(<span class="fu">attr</span>(research_plots, <span class="st">&quot;sf_column&quot;</span>))] <span class="ot">=</span> <span class="st">&quot;geometry&quot;</span></span>
<span id="cb3-14"><a href="vector_data.html#cb3-14" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_geometry</span>(research_plots) <span class="ot">=</span> <span class="st">&quot;geometry&quot;</span></span>
<span id="cb3-15"><a href="vector_data.html#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="vector_data.html#cb3-16" aria-hidden="true" tabindex="-1"></a><span class="co"># data structure of data</span></span>
<span id="cb3-17"><a href="vector_data.html#cb3-17" aria-hidden="true" tabindex="-1"></a>research_plots <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span>
<span id="cb3-18"><a href="vector_data.html#cb3-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-19"><a href="vector_data.html#cb3-19" aria-hidden="true" tabindex="-1"></a><span class="co"># plot does not uniquely identify record</span></span>
<span id="cb3-20"><a href="vector_data.html#cb3-20" aria-hidden="true" tabindex="-1"></a><span class="fu">length</span>(<span class="fu">unique</span>(research_plots<span class="sc">$</span>plot)) <span class="sc">==</span> <span class="fu">nrow</span>(research_plots)</span>
<span id="cb3-21"><a href="vector_data.html#cb3-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-22"><a href="vector_data.html#cb3-22" aria-hidden="true" tabindex="-1"></a><span class="co"># create id</span></span>
<span id="cb3-23"><a href="vector_data.html#cb3-23" aria-hidden="true" tabindex="-1"></a>  research_plots <span class="ot">&lt;-</span> research_plots <span class="sc">%&gt;%</span> </span>
<span id="cb3-24"><a href="vector_data.html#cb3-24" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(plot) <span class="sc">%&gt;%</span> </span>
<span id="cb3-25"><a href="vector_data.html#cb3-25" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb3-26"><a href="vector_data.html#cb3-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">plot_id =</span> <span class="fu">paste0</span>(plot, <span class="st">&quot;_&quot;</span>, <span class="fu">as.character</span>(dplyr<span class="sc">::</span><span class="fu">row_number</span>()))</span>
<span id="cb3-27"><a href="vector_data.html#cb3-27" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb3-28"><a href="vector_data.html#cb3-28" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb3-29"><a href="vector_data.html#cb3-29" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">relocate</span>(plot_id)</span>
<span id="cb3-30"><a href="vector_data.html#cb3-30" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb3-31"><a href="vector_data.html#cb3-31" aria-hidden="true" tabindex="-1"></a>  <span class="fu">length</span>(<span class="fu">unique</span>(research_plots<span class="sc">$</span>plot_id)) <span class="sc">==</span> <span class="fu">nrow</span>(research_plots)</span></code></pre></div>
</div>
<div id="load-stem-map-data" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Load Stem Map data<a href="vector_data.html#load-stem-map-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><a href="https://esajournals.onlinelibrary.wiley.com/doi/pdfdirect/10.1002/eap.2682">Ritter et al. 2022</a> installed three plots in the commercial thin treatment and each of the two free selection treatments. Only two plots were installed in the small group retention treatment as it was smaller in area and was bisected by a powerline corridor that precluded the placement of more than two nonoverlapping plots. Each plot was subdivided into 16 25x25 m quadrats within which all live trees &gt;1.37 m tall had their x, y locations recorded. In addition to mapping their x, y location, all live trees were tagged and had their DBH, tree height (TH), compacted crown base height (CBH), crown width (CW), and species recorded.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="vector_data.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load stem map shapefile</span></span>
<span id="cb4-2"><a href="vector_data.html#cb4-2" aria-hidden="true" tabindex="-1"></a>stem_map <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;../data/BHEF_stem_map.shp&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb4-3"><a href="vector_data.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(sf<span class="sc">::</span><span class="fu">st_is_valid</span>(.)) <span class="sc">%&gt;%</span> </span>
<span id="cb4-4"><a href="vector_data.html#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">tolower</span>(</span>
<span id="cb4-5"><a href="vector_data.html#cb4-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>, </span>
<span id="cb4-6"><a href="vector_data.html#cb4-6" aria-hidden="true" tabindex="-1"></a>       <span class="fu">str_trim</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s+&quot;</span>, <span class="st">&quot; &quot;</span>, .x))</span>
<span id="cb4-7"><a href="vector_data.html#cb4-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb4-8"><a href="vector_data.html#cb4-8" aria-hidden="true" tabindex="-1"></a>  )) <span class="sc">%&gt;%</span> </span>
<span id="cb4-9"><a href="vector_data.html#cb4-9" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(research_plots))</span>
<span id="cb4-10"><a href="vector_data.html#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="vector_data.html#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co">#rename sf geom column</span></span>
<span id="cb4-12"><a href="vector_data.html#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>(stem_map)[<span class="fu">names</span>(stem_map)<span class="sc">==</span><span class="fu">tolower</span>(<span class="fu">attr</span>(stem_map, <span class="st">&quot;sf_column&quot;</span>))] <span class="ot">=</span> <span class="st">&quot;geometry&quot;</span></span>
<span id="cb4-13"><a href="vector_data.html#cb4-13" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_geometry</span>(stem_map) <span class="ot">=</span> <span class="st">&quot;geometry&quot;</span></span>
<span id="cb4-14"><a href="vector_data.html#cb4-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-15"><a href="vector_data.html#cb4-15" aria-hidden="true" tabindex="-1"></a><span class="co"># data structure of stem map data</span></span>
<span id="cb4-16"><a href="vector_data.html#cb4-16" aria-hidden="true" tabindex="-1"></a>stem_map <span class="sc">%&gt;%</span> <span class="fu">glimpse</span>()</span></code></pre></div>
</div>
<div id="load-national-forests-shapefile" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Load National Forests shapefile<a href="vector_data.html#load-national-forests-shapefile" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="vector_data.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load forest boundary shapefile</span></span>
<span id="cb5-2"><a href="vector_data.html#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract file name</span></span>
<span id="cb5-3"><a href="vector_data.html#cb5-3" aria-hidden="true" tabindex="-1"></a>    f_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;../data&quot;</span>, <span class="st">&quot;/&quot;</span>, <span class="st">&quot;S_USA.NFSLandUnit.gdb&quot;</span>, <span class="st">&quot;/&quot;</span>)</span>
<span id="cb5-4"><a href="vector_data.html#cb5-4" aria-hidden="true" tabindex="-1"></a>    dta_nm <span class="ot">&lt;-</span> <span class="fu">paste</span>(f_path</span>
<span id="cb5-5"><a href="vector_data.html#cb5-5" aria-hidden="true" tabindex="-1"></a>      , <span class="fu">list.files</span>(f_path, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.gdb$&quot;</span>)[<span class="dv">1</span>]</span>
<span id="cb5-6"><a href="vector_data.html#cb5-6" aria-hidden="true" tabindex="-1"></a>      , <span class="at">sep =</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb5-7"><a href="vector_data.html#cb5-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb5-8"><a href="vector_data.html#cb5-8" aria-hidden="true" tabindex="-1"></a>    lyr_nms <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_layers</span>(<span class="at">dsn =</span> dta_nm)<span class="sc">$</span>name</span>
<span id="cb5-9"><a href="vector_data.html#cb5-9" aria-hidden="true" tabindex="-1"></a>    lyr <span class="ot">&lt;-</span> lyr_nms[<span class="fu">grep</span>(<span class="st">&quot;NFSLandUnit&quot;</span>, lyr_nms)][<span class="dv">1</span>]</span>
<span id="cb5-10"><a href="vector_data.html#cb5-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load in data</span></span>
<span id="cb5-11"><a href="vector_data.html#cb5-11" aria-hidden="true" tabindex="-1"></a>    forests <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(</span>
<span id="cb5-12"><a href="vector_data.html#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">dsn =</span> dta_nm</span>
<span id="cb5-13"><a href="vector_data.html#cb5-13" aria-hidden="true" tabindex="-1"></a>        , <span class="at">layer =</span> lyr</span>
<span id="cb5-14"><a href="vector_data.html#cb5-14" aria-hidden="true" tabindex="-1"></a>        , <span class="at">query =</span> <span class="st">&quot;SELECT * FROM </span><span class="sc">\&quot;</span><span class="st">NFSLandUnit</span><span class="sc">\&quot;</span><span class="st"> </span></span>
<span id="cb5-15"><a href="vector_data.html#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="st">                WHERE </span></span>
<span id="cb5-16"><a href="vector_data.html#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="st">                  REGION NOT IN (&#39;08&#39;, &#39;09&#39;, &#39;10&#39;)</span></span>
<span id="cb5-17"><a href="vector_data.html#cb5-17" aria-hidden="true" tabindex="-1"></a><span class="st">                  AND NFSLANDUNITTYPE = &#39;National Forest&#39;</span></span>
<span id="cb5-18"><a href="vector_data.html#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="st">            &quot;</span></span>
<span id="cb5-19"><a href="vector_data.html#cb5-19" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb5-20"><a href="vector_data.html#cb5-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">tolower</span>(</span>
<span id="cb5-21"><a href="vector_data.html#cb5-21" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>, </span>
<span id="cb5-22"><a href="vector_data.html#cb5-22" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_trim</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s+&quot;</span>, <span class="st">&quot; &quot;</span>, .x))</span>
<span id="cb5-23"><a href="vector_data.html#cb5-23" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb5-24"><a href="vector_data.html#cb5-24" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb5-25"><a href="vector_data.html#cb5-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-26"><a href="vector_data.html#cb5-26" aria-hidden="true" tabindex="-1"></a>  <span class="co">#rename sf geom column</span></span>
<span id="cb5-27"><a href="vector_data.html#cb5-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(forests)[<span class="fu">names</span>(forests)<span class="sc">==</span><span class="fu">tolower</span>(<span class="fu">attr</span>(forests, <span class="st">&quot;sf_column&quot;</span>))] <span class="ot">=</span> <span class="st">&quot;geometry&quot;</span></span>
<span id="cb5-28"><a href="vector_data.html#cb5-28" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_geometry</span>(forests) <span class="ot">=</span> <span class="st">&quot;geometry&quot;</span></span>
<span id="cb5-29"><a href="vector_data.html#cb5-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-30"><a href="vector_data.html#cb5-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform</span></span>
<span id="cb5-31"><a href="vector_data.html#cb5-31" aria-hidden="true" tabindex="-1"></a>    forests <span class="ot">&lt;-</span> forests <span class="sc">%&gt;%</span> </span>
<span id="cb5-32"><a href="vector_data.html#cb5-32" aria-hidden="true" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(research_plots))</span>
<span id="cb5-33"><a href="vector_data.html#cb5-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-34"><a href="vector_data.html#cb5-34" aria-hidden="true" tabindex="-1"></a>  <span class="co">#make BHNF only dataset</span></span>
<span id="cb5-35"><a href="vector_data.html#cb5-35" aria-hidden="true" tabindex="-1"></a>    forests_bhnf <span class="ot">&lt;-</span> forests <span class="sc">%&gt;%</span> <span class="fu">filter</span>(region <span class="sc">==</span> <span class="st">&quot;02&quot;</span> <span class="sc">&amp;</span> nffid <span class="sc">==</span> <span class="st">&quot;0471&quot;</span>)</span></code></pre></div>
</div>
<div id="load-experimental-forests-shapefile" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Load Experimental Forests shapefile<a href="vector_data.html#load-experimental-forests-shapefile" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="vector_data.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load boundary shapefile</span></span>
<span id="cb6-2"><a href="vector_data.html#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># extract file name</span></span>
<span id="cb6-3"><a href="vector_data.html#cb6-3" aria-hidden="true" tabindex="-1"></a>    f_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(<span class="st">&quot;../data&quot;</span>, <span class="st">&quot;/&quot;</span>, <span class="st">&quot;S_USA.Experimental_Area_Boundaries.gdb&quot;</span>, <span class="st">&quot;/&quot;</span>)</span>
<span id="cb6-4"><a href="vector_data.html#cb6-4" aria-hidden="true" tabindex="-1"></a>    dta_nm <span class="ot">&lt;-</span> <span class="fu">paste</span>(f_path</span>
<span id="cb6-5"><a href="vector_data.html#cb6-5" aria-hidden="true" tabindex="-1"></a>      , <span class="fu">list.files</span>(f_path, <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.gdb$&quot;</span>)[<span class="dv">1</span>]</span>
<span id="cb6-6"><a href="vector_data.html#cb6-6" aria-hidden="true" tabindex="-1"></a>      , <span class="at">sep =</span> <span class="st">&quot;/&quot;</span></span>
<span id="cb6-7"><a href="vector_data.html#cb6-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb6-8"><a href="vector_data.html#cb6-8" aria-hidden="true" tabindex="-1"></a>    lyr_nms <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_layers</span>(<span class="at">dsn =</span> dta_nm)<span class="sc">$</span>name</span>
<span id="cb6-9"><a href="vector_data.html#cb6-9" aria-hidden="true" tabindex="-1"></a>    lyr <span class="ot">&lt;-</span> lyr_nms[<span class="fu">grep</span>(<span class="st">&quot;Experimental_Area_Boundaries&quot;</span>, lyr_nms)][<span class="dv">1</span>]</span>
<span id="cb6-10"><a href="vector_data.html#cb6-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load in data</span></span>
<span id="cb6-11"><a href="vector_data.html#cb6-11" aria-hidden="true" tabindex="-1"></a>    exp_forests <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(</span>
<span id="cb6-12"><a href="vector_data.html#cb6-12" aria-hidden="true" tabindex="-1"></a>        <span class="at">dsn =</span> dta_nm</span>
<span id="cb6-13"><a href="vector_data.html#cb6-13" aria-hidden="true" tabindex="-1"></a>        , <span class="at">layer =</span> lyr</span>
<span id="cb6-14"><a href="vector_data.html#cb6-14" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span></span>
<span id="cb6-15"><a href="vector_data.html#cb6-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">tolower</span>(</span>
<span id="cb6-16"><a href="vector_data.html#cb6-16" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>,</span>
<span id="cb6-17"><a href="vector_data.html#cb6-17" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_trim</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s+&quot;</span>, <span class="st">&quot; &quot;</span>, .x))</span>
<span id="cb6-18"><a href="vector_data.html#cb6-18" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb6-19"><a href="vector_data.html#cb6-19" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb6-20"><a href="vector_data.html#cb6-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-21"><a href="vector_data.html#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="co">#rename sf geom column</span></span>
<span id="cb6-22"><a href="vector_data.html#cb6-22" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(exp_forests)[<span class="fu">names</span>(exp_forests)<span class="sc">==</span><span class="fu">tolower</span>(<span class="fu">attr</span>(exp_forests, <span class="st">&quot;sf_column&quot;</span>))] <span class="ot">=</span> <span class="st">&quot;geometry&quot;</span></span>
<span id="cb6-23"><a href="vector_data.html#cb6-23" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_geometry</span>(exp_forests) <span class="ot">=</span> <span class="st">&quot;geometry&quot;</span></span>
<span id="cb6-24"><a href="vector_data.html#cb6-24" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-25"><a href="vector_data.html#cb6-25" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform</span></span>
<span id="cb6-26"><a href="vector_data.html#cb6-26" aria-hidden="true" tabindex="-1"></a>    exp_forests <span class="ot">&lt;-</span> exp_forests <span class="sc">%&gt;%</span> </span>
<span id="cb6-27"><a href="vector_data.html#cb6-27" aria-hidden="true" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(research_plots))</span>
<span id="cb6-28"><a href="vector_data.html#cb6-28" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb6-29"><a href="vector_data.html#cb6-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># spatial join BHNF</span></span>
<span id="cb6-30"><a href="vector_data.html#cb6-30" aria-hidden="true" tabindex="-1"></a>    bhef_boundary <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_intersection</span>(forests_bhnf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(nfslandunitid, nffid, nfslandunitname), exp_forests)</span></code></pre></div>
</div>
<div id="harvests" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Load FACTS Timber Harvests<a href="vector_data.html#harvests" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Metadata file available <a href="https://data.fs.usda.gov/geodata/edw/edw_resources/meta/S_USA.Activity_TimberHarvest.xml">here</a>.</p>
<p><em>Utilize data downloaded and created in Forest Management Impacts on Productivity <a href="https://github.com/georgewoolsey/harvest_npp">project</a>.</em></p>
<p><a href="https://www.fs.usda.gov/Internet/FSE_DOCUMENTS/fseprd539041.pdf">This appendix</a> includes a listing of all the active and inactive FACTS activity codes, as well as detailed descriptions of some of the codes.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="vector_data.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load boundary shapefile</span></span>
<span id="cb7-2"><a href="vector_data.html#cb7-2" aria-hidden="true" tabindex="-1"></a>    harvests <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;../data/harvests.gpkg&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb7-3"><a href="vector_data.html#cb7-3" aria-hidden="true" tabindex="-1"></a>      <span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">tolower</span>(</span>
<span id="cb7-4"><a href="vector_data.html#cb7-4" aria-hidden="true" tabindex="-1"></a>        <span class="fu">gsub</span>(<span class="st">&quot; &quot;</span>, <span class="st">&quot;_&quot;</span>,</span>
<span id="cb7-5"><a href="vector_data.html#cb7-5" aria-hidden="true" tabindex="-1"></a>           <span class="fu">str_trim</span>(<span class="fu">gsub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">s+&quot;</span>, <span class="st">&quot; &quot;</span>, .x))</span>
<span id="cb7-6"><a href="vector_data.html#cb7-6" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb7-7"><a href="vector_data.html#cb7-7" aria-hidden="true" tabindex="-1"></a>      ))</span>
<span id="cb7-8"><a href="vector_data.html#cb7-8" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-9"><a href="vector_data.html#cb7-9" aria-hidden="true" tabindex="-1"></a>  <span class="co">#rename sf geom column</span></span>
<span id="cb7-10"><a href="vector_data.html#cb7-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">names</span>(harvests)[<span class="fu">names</span>(harvests)<span class="sc">==</span><span class="fu">tolower</span>(<span class="fu">attr</span>(harvests, <span class="st">&quot;sf_column&quot;</span>))] <span class="ot">=</span> <span class="st">&quot;geometry&quot;</span></span>
<span id="cb7-11"><a href="vector_data.html#cb7-11" aria-hidden="true" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_geometry</span>(harvests) <span class="ot">=</span> <span class="st">&quot;geometry&quot;</span></span>
<span id="cb7-12"><a href="vector_data.html#cb7-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-13"><a href="vector_data.html#cb7-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># transform</span></span>
<span id="cb7-14"><a href="vector_data.html#cb7-14" aria-hidden="true" tabindex="-1"></a>    harvests <span class="ot">&lt;-</span> harvests <span class="sc">%&gt;%</span> </span>
<span id="cb7-15"><a href="vector_data.html#cb7-15" aria-hidden="true" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(research_plots))</span>
<span id="cb7-16"><a href="vector_data.html#cb7-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-17"><a href="vector_data.html#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># spatial join BHEF</span></span>
<span id="cb7-18"><a href="vector_data.html#cb7-18" aria-hidden="true" tabindex="-1"></a>    <span class="co"># bhef_harvests &lt;- sf::st_intersection(</span></span>
<span id="cb7-19"><a href="vector_data.html#cb7-19" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     bhef_boundary %&gt;% </span></span>
<span id="cb7-20"><a href="vector_data.html#cb7-20" aria-hidden="true" tabindex="-1"></a>    <span class="co">#        dplyr::select(name, station, hectares, lead_scientist) %&gt;% </span></span>
<span id="cb7-21"><a href="vector_data.html#cb7-21" aria-hidden="true" tabindex="-1"></a>    <span class="co">#        dplyr::rename_with(~ paste0(&quot;exp_forest_&quot;, .), -geometry) %&gt;% </span></span>
<span id="cb7-22"><a href="vector_data.html#cb7-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#       # there are some plots outside of BHEF boundary</span></span>
<span id="cb7-23"><a href="vector_data.html#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="co">#       sf::st_buffer(2500)</span></span>
<span id="cb7-24"><a href="vector_data.html#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="co">#     , harvests)</span></span>
<span id="cb7-25"><a href="vector_data.html#cb7-25" aria-hidden="true" tabindex="-1"></a>    bhef_harvests <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb7-26"><a href="vector_data.html#cb7-26" aria-hidden="true" tabindex="-1"></a>      <span class="co"># there are some plots outside of BHEF boundary</span></span>
<span id="cb7-27"><a href="vector_data.html#cb7-27" aria-hidden="true" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_union</span>(</span>
<span id="cb7-28"><a href="vector_data.html#cb7-28" aria-hidden="true" tabindex="-1"></a>            bhef_boundary</span>
<span id="cb7-29"><a href="vector_data.html#cb7-29" aria-hidden="true" tabindex="-1"></a>            , sf<span class="sc">::</span><span class="fu">st_as_sfc</span>(sf<span class="sc">::</span><span class="fu">st_bbox</span>(research_plots)) <span class="sc">%&gt;%</span> </span>
<span id="cb7-30"><a href="vector_data.html#cb7-30" aria-hidden="true" tabindex="-1"></a>                sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(research_plots)) </span>
<span id="cb7-31"><a href="vector_data.html#cb7-31" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(geometry)</span>
<span id="cb7-32"><a href="vector_data.html#cb7-32" aria-hidden="true" tabindex="-1"></a>        , harvests)</span>
<span id="cb7-33"><a href="vector_data.html#cb7-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb7-34"><a href="vector_data.html#cb7-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-35"><a href="vector_data.html#cb7-35" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb7-36"><a href="vector_data.html#cb7-36" aria-hidden="true" tabindex="-1"></a><span class="co"># filter for last 15 years</span></span>
<span id="cb7-37"><a href="vector_data.html#cb7-37" aria-hidden="true" tabindex="-1"></a>bhef_harvests_l15 <span class="ot">&lt;-</span> bhef_harvests <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(year_id <span class="sc">&gt;=</span> <span class="fu">year</span>(<span class="fu">Sys.time</span>()) <span class="sc">-</span> <span class="dv">15</span> ) <span class="sc">%&gt;%</span> </span>
<span id="cb7-38"><a href="vector_data.html#cb7-38" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(lab <span class="ot">&lt;-</span> <span class="fu">paste0</span>(treatment_type_grp, <span class="st">&quot; (&quot;</span>, <span class="fu">as.character</span>(year_id), <span class="st">&quot;)&quot;</span>))</span></code></pre></div>
<div id="harvests-by-treatment-type" class="section level3 hasAnchor" number="3.6.1">
<h3><span class="header-section-number">3.6.1</span> Harvests by treatment type<a href="vector_data.html#harvests-by-treatment-type" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="vector_data.html#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># data by treatment type</span></span>
<span id="cb8-2"><a href="vector_data.html#cb8-2" aria-hidden="true" tabindex="-1"></a>bhef_harvests_l15 <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb8-3"><a href="vector_data.html#cb8-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(activity_name) <span class="sc">%&gt;%</span> </span>
<span id="cb8-4"><a href="vector_data.html#cb8-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n =</span> <span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb8-5"><a href="vector_data.html#cb8-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb8-6"><a href="vector_data.html#cb8-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(.) <span class="sc">+</span></span>
<span id="cb8-7"><a href="vector_data.html#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_col</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">reorder</span>(activity_name, n), <span class="at">x =</span> n, <span class="at">fill =</span> n), <span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb8-8"><a href="vector_data.html#cb8-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_text</span>(</span>
<span id="cb8-9"><a href="vector_data.html#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">reorder</span>(activity_name, n), <span class="at">x =</span>n, <span class="at">label =</span> scales<span class="sc">::</span><span class="fu">comma</span>(n, <span class="at">accuracy =</span> <span class="dv">1</span>))</span>
<span id="cb8-10"><a href="vector_data.html#cb8-10" aria-hidden="true" tabindex="-1"></a>    , <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">4</span></span>
<span id="cb8-11"><a href="vector_data.html#cb8-11" aria-hidden="true" tabindex="-1"></a>    , <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>)</span>
<span id="cb8-12"><a href="vector_data.html#cb8-12" aria-hidden="true" tabindex="-1"></a>    , <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.1</span></span>
<span id="cb8-13"><a href="vector_data.html#cb8-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb8-14"><a href="vector_data.html#cb8-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb8-15"><a href="vector_data.html#cb8-15" aria-hidden="true" tabindex="-1"></a>      <span class="at">title =</span> <span class="st">&quot;Number Harvests Completed by Treatment Type (last 15 years)&quot;</span></span>
<span id="cb8-16"><a href="vector_data.html#cb8-16" aria-hidden="true" tabindex="-1"></a>      , <span class="at">subtitle =</span> <span class="st">&quot;within BHEF boundary and bounding box of research plot area&quot;</span></span>
<span id="cb8-17"><a href="vector_data.html#cb8-17" aria-hidden="true" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb8-18"><a href="vector_data.html#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;# Harvests&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-19"><a href="vector_data.html#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Treatment&quot;</span>) <span class="sc">+</span></span>
<span id="cb8-20"><a href="vector_data.html#cb8-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>comma) <span class="sc">+</span></span>
<span id="cb8-21"><a href="vector_data.html#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_c</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">option =</span> <span class="st">&quot;cividis&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb8-22"><a href="vector_data.html#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb8-23"><a href="vector_data.html#cb8-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-24"><a href="vector_data.html#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb8-25"><a href="vector_data.html#cb8-25" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="bhef_rxfire_plan_files/figure-html/unnamed-chunk-11-1.png" width="960" /></p>
</div>
</div>
<div id="join-research-plot-to-harvest" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> Join Research Plot to Harvest<a href="vector_data.html#join-research-plot-to-harvest" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="vector_data.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># attach harvest data to research plots</span></span>
<span id="cb9-2"><a href="vector_data.html#cb9-2" aria-hidden="true" tabindex="-1"></a>research_plots_harvests <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb9-3"><a href="vector_data.html#cb9-3" aria-hidden="true" tabindex="-1"></a>  research_plots</span>
<span id="cb9-4"><a href="vector_data.html#cb9-4" aria-hidden="true" tabindex="-1"></a>  , bhef_harvests_l15 <span class="sc">%&gt;%</span> </span>
<span id="cb9-5"><a href="vector_data.html#cb9-5" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb9-6"><a href="vector_data.html#cb9-6" aria-hidden="true" tabindex="-1"></a>        activity_code</span>
<span id="cb9-7"><a href="vector_data.html#cb9-7" aria-hidden="true" tabindex="-1"></a>        , activity_name</span>
<span id="cb9-8"><a href="vector_data.html#cb9-8" aria-hidden="true" tabindex="-1"></a>        , treatment_type_grp</span>
<span id="cb9-9"><a href="vector_data.html#cb9-9" aria-hidden="true" tabindex="-1"></a>        , suid</span>
<span id="cb9-10"><a href="vector_data.html#cb9-10" aria-hidden="true" tabindex="-1"></a>        , date_compl</span>
<span id="cb9-11"><a href="vector_data.html#cb9-11" aria-hidden="true" tabindex="-1"></a>        , year_id</span>
<span id="cb9-12"><a href="vector_data.html#cb9-12" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-13"><a href="vector_data.html#cb9-13" aria-hidden="true" tabindex="-1"></a>      <span class="co"># dplyr::filter(treatment_type_grp %in% c(&quot;Commercial Thinning&quot;</span></span>
<span id="cb9-14"><a href="vector_data.html#cb9-14" aria-hidden="true" tabindex="-1"></a>      <span class="co">#                                         , &quot;Overstory Removal Cut&quot;</span></span>
<span id="cb9-15"><a href="vector_data.html#cb9-15" aria-hidden="true" tabindex="-1"></a>      <span class="co">#                                         , &quot;Single-tree/Group Selection Cut&quot;</span></span>
<span id="cb9-16"><a href="vector_data.html#cb9-16" aria-hidden="true" tabindex="-1"></a>      <span class="co">#                                         , &quot;Patch Clearcut&quot;</span></span>
<span id="cb9-17"><a href="vector_data.html#cb9-17" aria-hidden="true" tabindex="-1"></a>      <span class="co">#       )) %&gt;% </span></span>
<span id="cb9-18"><a href="vector_data.html#cb9-18" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">&quot;harvest_&quot;</span>, .), <span class="sc">-</span>geometry)</span>
<span id="cb9-19"><a href="vector_data.html#cb9-19" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-20"><a href="vector_data.html#cb9-20" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">harvest_plot_areamsq =</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_area</span>(.))) <span class="sc">%&gt;%</span> </span>
<span id="cb9-21"><a href="vector_data.html#cb9-21" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb9-22"><a href="vector_data.html#cb9-22" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(plot_id) <span class="sc">%&gt;%</span> </span>
<span id="cb9-23"><a href="vector_data.html#cb9-23" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(</span>
<span id="cb9-24"><a href="vector_data.html#cb9-24" aria-hidden="true" tabindex="-1"></a>    plot_id</span>
<span id="cb9-25"><a href="vector_data.html#cb9-25" aria-hidden="true" tabindex="-1"></a>    , <span class="fu">desc</span>(harvest_plot_areamsq)</span>
<span id="cb9-26"><a href="vector_data.html#cb9-26" aria-hidden="true" tabindex="-1"></a>    , harvest_date_compl</span>
<span id="cb9-27"><a href="vector_data.html#cb9-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-28"><a href="vector_data.html#cb9-28" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb9-29"><a href="vector_data.html#cb9-29" aria-hidden="true" tabindex="-1"></a>    plot_id</span>
<span id="cb9-30"><a href="vector_data.html#cb9-30" aria-hidden="true" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;harvest_&quot;</span>)</span>
<span id="cb9-31"><a href="vector_data.html#cb9-31" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-32"><a href="vector_data.html#cb9-32" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb9-33"><a href="vector_data.html#cb9-33" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_n =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb9-34"><a href="vector_data.html#cb9-34" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb9-35"><a href="vector_data.html#cb9-35" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-36"><a href="vector_data.html#cb9-36" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb9-37"><a href="vector_data.html#cb9-37" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> plot_id</span>
<span id="cb9-38"><a href="vector_data.html#cb9-38" aria-hidden="true" tabindex="-1"></a>    , <span class="at">names_from =</span> row_n</span>
<span id="cb9-39"><a href="vector_data.html#cb9-39" aria-hidden="true" tabindex="-1"></a>    , <span class="at">values_from =</span> <span class="sc">!</span><span class="fu">c</span>(plot_id, row_n)</span>
<span id="cb9-40"><a href="vector_data.html#cb9-40" aria-hidden="true" tabindex="-1"></a>    , <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span></span>
<span id="cb9-41"><a href="vector_data.html#cb9-41" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb9-42"><a href="vector_data.html#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="vector_data.html#cb9-43" aria-hidden="true" tabindex="-1"></a><span class="co"># join to spatial data</span></span>
<span id="cb9-44"><a href="vector_data.html#cb9-44" aria-hidden="true" tabindex="-1"></a>research_plots <span class="ot">&lt;-</span> research_plots <span class="sc">%&gt;%</span> </span>
<span id="cb9-45"><a href="vector_data.html#cb9-45" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(research_plots_harvests, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;plot_id&quot;</span><span class="ot">=</span><span class="st">&quot;plot_id&quot;</span>))</span>
<span id="cb9-46"><a href="vector_data.html#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="vector_data.html#cb9-47" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(research_plots_harvests)</span></code></pre></div>
</div>
<div id="join-stem-map-to-research-plot-harvest" class="section level2 hasAnchor" number="3.8">
<h2><span class="header-section-number">3.8</span> Join Stem Map to Research Plot &amp; Harvest<a href="vector_data.html#join-stem-map-to-research-plot-harvest" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="vector_data.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># attach harvest data to stem map</span></span>
<span id="cb10-2"><a href="vector_data.html#cb10-2" aria-hidden="true" tabindex="-1"></a>stem_map_harvests <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb10-3"><a href="vector_data.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  stem_map</span>
<span id="cb10-4"><a href="vector_data.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  , bhef_harvests_l15 <span class="sc">%&gt;%</span> </span>
<span id="cb10-5"><a href="vector_data.html#cb10-5" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb10-6"><a href="vector_data.html#cb10-6" aria-hidden="true" tabindex="-1"></a>        activity_code</span>
<span id="cb10-7"><a href="vector_data.html#cb10-7" aria-hidden="true" tabindex="-1"></a>        , activity_name</span>
<span id="cb10-8"><a href="vector_data.html#cb10-8" aria-hidden="true" tabindex="-1"></a>        , treatment_type_grp</span>
<span id="cb10-9"><a href="vector_data.html#cb10-9" aria-hidden="true" tabindex="-1"></a>        , suid</span>
<span id="cb10-10"><a href="vector_data.html#cb10-10" aria-hidden="true" tabindex="-1"></a>        , date_compl</span>
<span id="cb10-11"><a href="vector_data.html#cb10-11" aria-hidden="true" tabindex="-1"></a>        , year_id</span>
<span id="cb10-12"><a href="vector_data.html#cb10-12" aria-hidden="true" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-13"><a href="vector_data.html#cb10-13" aria-hidden="true" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">&quot;harvest_&quot;</span>, .), <span class="sc">-</span>geometry)</span>
<span id="cb10-14"><a href="vector_data.html#cb10-14" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-15"><a href="vector_data.html#cb10-15" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb10-16"><a href="vector_data.html#cb10-16" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(uidtree) <span class="sc">%&gt;%</span> </span>
<span id="cb10-17"><a href="vector_data.html#cb10-17" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(</span>
<span id="cb10-18"><a href="vector_data.html#cb10-18" aria-hidden="true" tabindex="-1"></a>    uidtree</span>
<span id="cb10-19"><a href="vector_data.html#cb10-19" aria-hidden="true" tabindex="-1"></a>    , harvest_date_compl</span>
<span id="cb10-20"><a href="vector_data.html#cb10-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-21"><a href="vector_data.html#cb10-21" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb10-22"><a href="vector_data.html#cb10-22" aria-hidden="true" tabindex="-1"></a>    uidtree</span>
<span id="cb10-23"><a href="vector_data.html#cb10-23" aria-hidden="true" tabindex="-1"></a>    , dplyr<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;harvest_&quot;</span>)</span>
<span id="cb10-24"><a href="vector_data.html#cb10-24" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-25"><a href="vector_data.html#cb10-25" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb10-26"><a href="vector_data.html#cb10-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">row_n =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>()</span>
<span id="cb10-27"><a href="vector_data.html#cb10-27" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-28"><a href="vector_data.html#cb10-28" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb10-29"><a href="vector_data.html#cb10-29" aria-hidden="true" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(</span>
<span id="cb10-30"><a href="vector_data.html#cb10-30" aria-hidden="true" tabindex="-1"></a>    <span class="at">id_cols =</span> uidtree</span>
<span id="cb10-31"><a href="vector_data.html#cb10-31" aria-hidden="true" tabindex="-1"></a>    , <span class="at">names_from =</span> row_n</span>
<span id="cb10-32"><a href="vector_data.html#cb10-32" aria-hidden="true" tabindex="-1"></a>    , <span class="at">values_from =</span> <span class="sc">!</span><span class="fu">c</span>(uidtree, row_n)</span>
<span id="cb10-33"><a href="vector_data.html#cb10-33" aria-hidden="true" tabindex="-1"></a>    , <span class="at">names_sep =</span> <span class="st">&quot;_&quot;</span></span>
<span id="cb10-34"><a href="vector_data.html#cb10-34" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb10-35"><a href="vector_data.html#cb10-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-36"><a href="vector_data.html#cb10-36" aria-hidden="true" tabindex="-1"></a><span class="co"># join to spatial data</span></span>
<span id="cb10-37"><a href="vector_data.html#cb10-37" aria-hidden="true" tabindex="-1"></a>stem_map <span class="ot">&lt;-</span> stem_map <span class="sc">%&gt;%</span> </span>
<span id="cb10-38"><a href="vector_data.html#cb10-38" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(stem_map_harvests, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;uidtree&quot;</span><span class="ot">=</span><span class="st">&quot;uidtree&quot;</span>))</span>
<span id="cb10-39"><a href="vector_data.html#cb10-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-40"><a href="vector_data.html#cb10-40" aria-hidden="true" tabindex="-1"></a><span class="co"># join to research plot data</span></span>
<span id="cb10-41"><a href="vector_data.html#cb10-41" aria-hidden="true" tabindex="-1"></a>temp_stem_map <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb10-42"><a href="vector_data.html#cb10-42" aria-hidden="true" tabindex="-1"></a>    stem_map <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(uidtree)</span>
<span id="cb10-43"><a href="vector_data.html#cb10-43" aria-hidden="true" tabindex="-1"></a>    , research_plots <span class="sc">%&gt;%</span> </span>
<span id="cb10-44"><a href="vector_data.html#cb10-44" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(plot_id, trt, harvest_activity_name_1, harvest_year_id_1, harvest_treatment_type_grp_1) <span class="sc">%&gt;%</span> </span>
<span id="cb10-45"><a href="vector_data.html#cb10-45" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="sc">~</span> <span class="fu">paste0</span>(<span class="st">&quot;rplot_&quot;</span>, .), <span class="sc">-</span>geometry)</span>
<span id="cb10-46"><a href="vector_data.html#cb10-46" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb10-47"><a href="vector_data.html#cb10-47" aria-hidden="true" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>)</span>
<span id="cb10-48"><a href="vector_data.html#cb10-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-49"><a href="vector_data.html#cb10-49" aria-hidden="true" tabindex="-1"></a>stem_map <span class="ot">&lt;-</span> stem_map <span class="sc">%&gt;%</span> </span>
<span id="cb10-50"><a href="vector_data.html#cb10-50" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(temp_stem_map, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;uidtree&quot;</span><span class="ot">=</span><span class="st">&quot;uidtree&quot;</span>))</span>
<span id="cb10-51"><a href="vector_data.html#cb10-51" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-52"><a href="vector_data.html#cb10-52" aria-hidden="true" tabindex="-1"></a><span class="fu">remove</span>(<span class="at">list =</span> <span class="fu">c</span>(<span class="st">&quot;stem_map_harvests&quot;</span>, <span class="st">&quot;temp_stem_map&quot;</span>))</span></code></pre></div>
<div id="stem-map-descriptive-statistics." class="section level3 hasAnchor" number="3.8.1">
<h3><span class="header-section-number">3.8.1</span> Stem Map Descriptive statistics.<a href="vector_data.html#stem-map-descriptive-statistics." class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="vector_data.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># descriptive stats</span></span>
<span id="cb11-2"><a href="vector_data.html#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">kable</span>(stem_map <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="cn">NULL</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="vector_data.html#cb11-3" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">group_by</span>(</span>
<span id="cb11-4"><a href="vector_data.html#cb11-4" aria-hidden="true" tabindex="-1"></a>          unit</span>
<span id="cb11-5"><a href="vector_data.html#cb11-5" aria-hidden="true" tabindex="-1"></a>          , harvest_activity_name_1</span>
<span id="cb11-6"><a href="vector_data.html#cb11-6" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb11-7"><a href="vector_data.html#cb11-7" aria-hidden="true" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb11-8"><a href="vector_data.html#cb11-8" aria-hidden="true" tabindex="-1"></a>          <span class="co"># plots = dplyr::n_distinct(plot)</span></span>
<span id="cb11-9"><a href="vector_data.html#cb11-9" aria-hidden="true" tabindex="-1"></a>          <span class="at">trees =</span> dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(uidtree)</span>
<span id="cb11-10"><a href="vector_data.html#cb11-10" aria-hidden="true" tabindex="-1"></a>          , <span class="at">min_DBHin =</span> <span class="fu">min</span>(dbhin)</span>
<span id="cb11-11"><a href="vector_data.html#cb11-11" aria-hidden="true" tabindex="-1"></a>          , <span class="at">max_DBHin =</span> <span class="fu">max</span>(dbhin)</span>
<span id="cb11-12"><a href="vector_data.html#cb11-12" aria-hidden="true" tabindex="-1"></a>          , <span class="at">mean_DBHin =</span> <span class="fu">mean</span>(dbhin)</span>
<span id="cb11-13"><a href="vector_data.html#cb11-13" aria-hidden="true" tabindex="-1"></a>          , <span class="at">QMDin =</span> <span class="fu">sqrt</span>( <span class="fu">sum</span>(dbhin<span class="sc">*</span>dbhin) <span class="sc">/</span> <span class="fu">n</span>() )</span>
<span id="cb11-14"><a href="vector_data.html#cb11-14" aria-hidden="true" tabindex="-1"></a>          , <span class="at">min_HTft =</span> <span class="fu">min</span>(heightft)</span>
<span id="cb11-15"><a href="vector_data.html#cb11-15" aria-hidden="true" tabindex="-1"></a>          , <span class="at">max_HTft =</span> <span class="fu">max</span>(heightft)</span>
<span id="cb11-16"><a href="vector_data.html#cb11-16" aria-hidden="true" tabindex="-1"></a>          , <span class="at">mean_HTft =</span> <span class="fu">mean</span>(heightft)</span>
<span id="cb11-17"><a href="vector_data.html#cb11-17" aria-hidden="true" tabindex="-1"></a>          , <span class="at">stdev_HTft =</span> <span class="fu">sd</span>(heightft)</span>
<span id="cb11-18"><a href="vector_data.html#cb11-18" aria-hidden="true" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb11-19"><a href="vector_data.html#cb11-19" aria-hidden="true" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">arrange</span>(unit, <span class="fu">desc</span>(trees)) </span>
<span id="cb11-20"><a href="vector_data.html#cb11-20" aria-hidden="true" tabindex="-1"></a>  , <span class="at">format =</span> <span class="st">&quot;html&quot;</span> </span>
<span id="cb11-21"><a href="vector_data.html#cb11-21" aria-hidden="true" tabindex="-1"></a>  , <span class="at">caption =</span> <span class="st">&quot;Tree Measurement Descriptive Statistics by Unit &amp; Treatment&quot;</span></span>
<span id="cb11-22"><a href="vector_data.html#cb11-22" aria-hidden="true" tabindex="-1"></a>  , <span class="at">digits =</span> <span class="dv">1</span></span>
<span id="cb11-23"><a href="vector_data.html#cb11-23" aria-hidden="true" tabindex="-1"></a>  , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb11-24"><a href="vector_data.html#cb11-24" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;unit&quot;</span></span>
<span id="cb11-25"><a href="vector_data.html#cb11-25" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;treatment&quot;</span></span>
<span id="cb11-26"><a href="vector_data.html#cb11-26" aria-hidden="true" tabindex="-1"></a>    <span class="co"># , &quot;# plots&quot;</span></span>
<span id="cb11-27"><a href="vector_data.html#cb11-27" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;# trees&quot;</span></span>
<span id="cb11-28"><a href="vector_data.html#cb11-28" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;min&quot;</span></span>
<span id="cb11-29"><a href="vector_data.html#cb11-29" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;max&quot;</span></span>
<span id="cb11-30"><a href="vector_data.html#cb11-30" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;mean&quot;</span></span>
<span id="cb11-31"><a href="vector_data.html#cb11-31" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;QMD&quot;</span></span>
<span id="cb11-32"><a href="vector_data.html#cb11-32" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;min&quot;</span></span>
<span id="cb11-33"><a href="vector_data.html#cb11-33" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;max&quot;</span></span>
<span id="cb11-34"><a href="vector_data.html#cb11-34" aria-hidden="true" tabindex="-1"></a>    , <span class="st">&quot;mean&quot;</span></span>
<span id="cb11-35"><a href="vector_data.html#cb11-35" aria-hidden="true" tabindex="-1"></a>      , <span class="st">&quot;st.dev.&quot;</span></span>
<span id="cb11-36"><a href="vector_data.html#cb11-36" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb11-37"><a href="vector_data.html#cb11-37" aria-hidden="true" tabindex="-1"></a>  , <span class="at">align=</span><span class="fu">rep</span>(<span class="st">&#39;c&#39;</span>, <span class="dv">5</span>)</span>
<span id="cb11-38"><a href="vector_data.html#cb11-38" aria-hidden="true" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb11-39"><a href="vector_data.html#cb11-39" aria-hidden="true" tabindex="-1"></a><span class="co"># kable_classic() %&gt;%</span></span>
<span id="cb11-40"><a href="vector_data.html#cb11-40" aria-hidden="true" tabindex="-1"></a><span class="fu">add_header_above</span>(<span class="fu">c</span>(<span class="st">&quot; &quot;</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">&quot;DBH (in.)&quot;</span> <span class="ot">=</span> <span class="dv">3</span>, <span class="st">&quot;QMD (in.)&quot;</span> <span class="ot">=</span> <span class="dv">1</span>, <span class="st">&quot;Height (ft.)&quot;</span> <span class="ot">=</span> <span class="dv">4</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb11-41"><a href="vector_data.html#cb11-41" aria-hidden="true" tabindex="-1"></a><span class="fu">kable_material</span>(<span class="fu">c</span>(<span class="st">&quot;striped&quot;</span>, <span class="st">&quot;hover&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb11-42"><a href="vector_data.html#cb11-42" aria-hidden="true" tabindex="-1"></a><span class="co"># column_spec(., 2, width = &quot;20em&quot;) %&gt;% </span></span>
<span id="cb11-43"><a href="vector_data.html#cb11-43" aria-hidden="true" tabindex="-1"></a><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">11</span>)</span></code></pre></div>
</div>
</div>
<div id="map-harvests-research-plots-stem-map" class="section level2 hasAnchor" number="3.9">
<h2><span class="header-section-number">3.9</span> Map Harvests, Research Plots, Stem Map<a href="vector_data.html#map-harvests-research-plots-stem-map" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="vector_data.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make map</span></span>
<span id="cb12-2"><a href="vector_data.html#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="co"># different background map types: https://leaflet-extras.github.io/leaflet-providers/preview/</span></span>
<span id="cb12-3"><a href="vector_data.html#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="co"># names(leaflet.providers::providers_loaded()$providers)</span></span>
<span id="cb12-4"><a href="vector_data.html#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="fu">mapviewOptions</span>(<span class="at">homebutton =</span> <span class="cn">FALSE</span>, <span class="at">basemaps =</span> <span class="fu">c</span>(<span class="st">&quot;Esri&quot;</span>))</span>
<span id="cb12-5"><a href="vector_data.html#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="co"># map</span></span>
<span id="cb12-6"><a href="vector_data.html#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(bhef_boundary</span>
<span id="cb12-7"><a href="vector_data.html#cb12-7" aria-hidden="true" tabindex="-1"></a>        , <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb12-8"><a href="vector_data.html#cb12-8" aria-hidden="true" tabindex="-1"></a>        , <span class="at">lwd =</span> <span class="dv">3</span></span>
<span id="cb12-9"><a href="vector_data.html#cb12-9" aria-hidden="true" tabindex="-1"></a>        , <span class="at">alpha.regions =</span> <span class="dv">0</span></span>
<span id="cb12-10"><a href="vector_data.html#cb12-10" aria-hidden="true" tabindex="-1"></a>        , <span class="at">label =</span> <span class="cn">FALSE</span></span>
<span id="cb12-11"><a href="vector_data.html#cb12-11" aria-hidden="true" tabindex="-1"></a>        , <span class="at">legend =</span> <span class="cn">FALSE</span></span>
<span id="cb12-12"><a href="vector_data.html#cb12-12" aria-hidden="true" tabindex="-1"></a>        , <span class="at">popup =</span> <span class="cn">FALSE</span></span>
<span id="cb12-13"><a href="vector_data.html#cb12-13" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb12-14"><a href="vector_data.html#cb12-14" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(bhef_harvests_l15</span>
<span id="cb12-15"><a href="vector_data.html#cb12-15" aria-hidden="true" tabindex="-1"></a>        , <span class="at">zcol =</span> <span class="st">&quot;treatment_type_grp&quot;</span></span>
<span id="cb12-16"><a href="vector_data.html#cb12-16" aria-hidden="true" tabindex="-1"></a>        , <span class="at">col.regions =</span> viridis<span class="sc">::</span><span class="fu">viridis</span>(<span class="at">n=</span><span class="fu">length</span>(<span class="fu">unique</span>(bhef_harvests_l15<span class="sc">$</span>treatment_type_grp)))</span>
<span id="cb12-17"><a href="vector_data.html#cb12-17" aria-hidden="true" tabindex="-1"></a>        , <span class="at">alpha.regions =</span> <span class="fl">0.6</span></span>
<span id="cb12-18"><a href="vector_data.html#cb12-18" aria-hidden="true" tabindex="-1"></a>        , <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;lab&quot;</span>)</span>
<span id="cb12-19"><a href="vector_data.html#cb12-19" aria-hidden="true" tabindex="-1"></a>        , <span class="at">legend =</span> <span class="cn">FALSE</span></span>
<span id="cb12-20"><a href="vector_data.html#cb12-20" aria-hidden="true" tabindex="-1"></a>          , <span class="at">popup =</span> <span class="fu">popupTable</span>(</span>
<span id="cb12-21"><a href="vector_data.html#cb12-21" aria-hidden="true" tabindex="-1"></a>              bhef_harvests_l15</span>
<span id="cb12-22"><a href="vector_data.html#cb12-22" aria-hidden="true" tabindex="-1"></a>              , <span class="at">zcol =</span> <span class="fu">c</span>(</span>
<span id="cb12-23"><a href="vector_data.html#cb12-23" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;year_id&quot;</span></span>
<span id="cb12-24"><a href="vector_data.html#cb12-24" aria-hidden="true" tabindex="-1"></a>                , <span class="st">&quot;treatment_type_grp&quot;</span></span>
<span id="cb12-25"><a href="vector_data.html#cb12-25" aria-hidden="true" tabindex="-1"></a>                , <span class="st">&quot;activity_name&quot;</span></span>
<span id="cb12-26"><a href="vector_data.html#cb12-26" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb12-27"><a href="vector_data.html#cb12-27" aria-hidden="true" tabindex="-1"></a>              , <span class="at">row.numbers =</span> <span class="cn">FALSE</span></span>
<span id="cb12-28"><a href="vector_data.html#cb12-28" aria-hidden="true" tabindex="-1"></a>              , <span class="at">feature.id =</span> <span class="cn">FALSE</span></span>
<span id="cb12-29"><a href="vector_data.html#cb12-29" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb12-30"><a href="vector_data.html#cb12-30" aria-hidden="true" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb12-31"><a href="vector_data.html#cb12-31" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(research_plots</span>
<span id="cb12-32"><a href="vector_data.html#cb12-32" aria-hidden="true" tabindex="-1"></a>        , <span class="at">zcol =</span> <span class="st">&quot;trt&quot;</span></span>
<span id="cb12-33"><a href="vector_data.html#cb12-33" aria-hidden="true" tabindex="-1"></a>        , <span class="at">col.regions =</span> viridis<span class="sc">::</span><span class="fu">mako</span>(<span class="at">n=</span><span class="fu">length</span>(<span class="fu">unique</span>(research_plots<span class="sc">$</span>trt)), <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb12-34"><a href="vector_data.html#cb12-34" aria-hidden="true" tabindex="-1"></a>        , <span class="at">lwd =</span> <span class="dv">2</span></span>
<span id="cb12-35"><a href="vector_data.html#cb12-35" aria-hidden="true" tabindex="-1"></a>        , <span class="at">col =</span> <span class="st">&quot;gray90&quot;</span></span>
<span id="cb12-36"><a href="vector_data.html#cb12-36" aria-hidden="true" tabindex="-1"></a>        , <span class="at">alpha.regions =</span> <span class="fl">0.8</span></span>
<span id="cb12-37"><a href="vector_data.html#cb12-37" aria-hidden="true" tabindex="-1"></a>        , <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;trt&quot;</span>)</span>
<span id="cb12-38"><a href="vector_data.html#cb12-38" aria-hidden="true" tabindex="-1"></a>        , <span class="at">legend =</span> <span class="cn">FALSE</span></span>
<span id="cb12-39"><a href="vector_data.html#cb12-39" aria-hidden="true" tabindex="-1"></a>          , <span class="at">popup =</span> <span class="fu">popupTable</span>(</span>
<span id="cb12-40"><a href="vector_data.html#cb12-40" aria-hidden="true" tabindex="-1"></a>              research_plots</span>
<span id="cb12-41"><a href="vector_data.html#cb12-41" aria-hidden="true" tabindex="-1"></a>              , <span class="at">zcol =</span> <span class="fu">c</span>(</span>
<span id="cb12-42"><a href="vector_data.html#cb12-42" aria-hidden="true" tabindex="-1"></a>                <span class="st">&quot;plot&quot;</span></span>
<span id="cb12-43"><a href="vector_data.html#cb12-43" aria-hidden="true" tabindex="-1"></a>                , <span class="st">&quot;trt&quot;</span></span>
<span id="cb12-44"><a href="vector_data.html#cb12-44" aria-hidden="true" tabindex="-1"></a>                , <span class="st">&quot;harvest_activity_name_1&quot;</span></span>
<span id="cb12-45"><a href="vector_data.html#cb12-45" aria-hidden="true" tabindex="-1"></a>                , <span class="st">&quot;harvest_year_id_1&quot;</span></span>
<span id="cb12-46"><a href="vector_data.html#cb12-46" aria-hidden="true" tabindex="-1"></a>              )</span>
<span id="cb12-47"><a href="vector_data.html#cb12-47" aria-hidden="true" tabindex="-1"></a>              , <span class="at">row.numbers =</span> <span class="cn">FALSE</span></span>
<span id="cb12-48"><a href="vector_data.html#cb12-48" aria-hidden="true" tabindex="-1"></a>              , <span class="at">feature.id =</span> <span class="cn">FALSE</span></span>
<span id="cb12-49"><a href="vector_data.html#cb12-49" aria-hidden="true" tabindex="-1"></a>            )</span>
<span id="cb12-50"><a href="vector_data.html#cb12-50" aria-hidden="true" tabindex="-1"></a>)  <span class="sc">+</span></span>
<span id="cb12-51"><a href="vector_data.html#cb12-51" aria-hidden="true" tabindex="-1"></a><span class="fu">mapview</span>(stem_map</span>
<span id="cb12-52"><a href="vector_data.html#cb12-52" aria-hidden="true" tabindex="-1"></a>  , <span class="at">zcol =</span> <span class="st">&quot;unit&quot;</span></span>
<span id="cb12-53"><a href="vector_data.html#cb12-53" aria-hidden="true" tabindex="-1"></a>  , <span class="at">col.regions =</span> viridis<span class="sc">::</span><span class="fu">turbo</span>(<span class="at">n=</span><span class="fu">length</span>(<span class="fu">unique</span>(stem_map<span class="sc">$</span>unit)), <span class="at">alpha =</span> <span class="fl">0.8</span>)</span>
<span id="cb12-54"><a href="vector_data.html#cb12-54" aria-hidden="true" tabindex="-1"></a>    <span class="co"># RColorBrewer::brewer.pal(n = length(unique(stem_map$unit)), name = &quot;RdYlBu&quot;)</span></span>
<span id="cb12-55"><a href="vector_data.html#cb12-55" aria-hidden="true" tabindex="-1"></a>  , <span class="at">cex =</span> <span class="fl">3.5</span></span>
<span id="cb12-56"><a href="vector_data.html#cb12-56" aria-hidden="true" tabindex="-1"></a>  , <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;unit&quot;</span>)</span>
<span id="cb12-57"><a href="vector_data.html#cb12-57" aria-hidden="true" tabindex="-1"></a>  , <span class="at">legend =</span> <span class="cn">FALSE</span></span>
<span id="cb12-58"><a href="vector_data.html#cb12-58" aria-hidden="true" tabindex="-1"></a>    , <span class="at">popup =</span> <span class="fu">popupTable</span>(</span>
<span id="cb12-59"><a href="vector_data.html#cb12-59" aria-hidden="true" tabindex="-1"></a>        stem_map</span>
<span id="cb12-60"><a href="vector_data.html#cb12-60" aria-hidden="true" tabindex="-1"></a>        , <span class="at">zcol =</span> <span class="fu">c</span>(</span>
<span id="cb12-61"><a href="vector_data.html#cb12-61" aria-hidden="true" tabindex="-1"></a>          <span class="st">&quot;unit&quot;</span></span>
<span id="cb12-62"><a href="vector_data.html#cb12-62" aria-hidden="true" tabindex="-1"></a>          , <span class="st">&quot;plot&quot;</span></span>
<span id="cb12-63"><a href="vector_data.html#cb12-63" aria-hidden="true" tabindex="-1"></a>          , <span class="st">&quot;species&quot;</span></span>
<span id="cb12-64"><a href="vector_data.html#cb12-64" aria-hidden="true" tabindex="-1"></a>          , <span class="st">&quot;tag&quot;</span></span>
<span id="cb12-65"><a href="vector_data.html#cb12-65" aria-hidden="true" tabindex="-1"></a>          , <span class="st">&quot;heightft&quot;</span></span>
<span id="cb12-66"><a href="vector_data.html#cb12-66" aria-hidden="true" tabindex="-1"></a>          , <span class="st">&quot;dbhin&quot;</span></span>
<span id="cb12-67"><a href="vector_data.html#cb12-67" aria-hidden="true" tabindex="-1"></a>          , <span class="st">&quot;harvest_activity_name_1&quot;</span></span>
<span id="cb12-68"><a href="vector_data.html#cb12-68" aria-hidden="true" tabindex="-1"></a>          , <span class="st">&quot;harvest_year_id_1&quot;</span></span>
<span id="cb12-69"><a href="vector_data.html#cb12-69" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb12-70"><a href="vector_data.html#cb12-70" aria-hidden="true" tabindex="-1"></a>        , <span class="at">row.numbers =</span> <span class="cn">FALSE</span></span>
<span id="cb12-71"><a href="vector_data.html#cb12-71" aria-hidden="true" tabindex="-1"></a>        , <span class="at">feature.id =</span> <span class="cn">FALSE</span></span>
<span id="cb12-72"><a href="vector_data.html#cb12-72" aria-hidden="true" tabindex="-1"></a>      )</span>
<span id="cb12-73"><a href="vector_data.html#cb12-73" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<p><em>Note, only harvests in last 15 years shown</em></p>
</div>
<div id="write-out-data" class="section level2 hasAnchor" number="3.10">
<h2><span class="header-section-number">3.10</span> Write Out Data<a href="vector_data.html#write-out-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="vector_data.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># save cleaned data for reading to R later</span></span>
<span id="cb13-2"><a href="vector_data.html#cb13-2" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(forests_bhnf, <span class="st">&quot;../data/forests_bhnf.gpkg&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-3"><a href="vector_data.html#cb13-3" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(bhef_boundary, <span class="st">&quot;../data/bhef_boundary.gpkg&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-4"><a href="vector_data.html#cb13-4" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(bhef_harvests, <span class="st">&quot;../data/bhef_harvests.gpkg&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-5"><a href="vector_data.html#cb13-5" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(research_plots, <span class="st">&quot;../data/research_plots.gpkg&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb13-6"><a href="vector_data.html#cb13-6" aria-hidden="true" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">st_write</span>(stem_map, <span class="st">&quot;../data/stem_map.gpkg&quot;</span>, <span class="at">append =</span> <span class="cn">FALSE</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="objective.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="stem_map.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
